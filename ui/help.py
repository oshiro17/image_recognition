# ui/help.py
import streamlit as st

def help_expander(title: str, body_md: str, default_open: bool = False):
    """ラベル直下などに置ける展開式のヘルプボックス。"""
    with st.expander("❓ " + title, expanded=default_open):
        st.markdown(body_md)

HELP_MD = {
    "min_wh": (
        "最小ボックス幅/高さ（px）＝ min_wh",
        """
- 差分から作る小ボックスの最小サイズ。これ未満はノイズとして捨てる。
- 大きくすると: ノイズ減るが細かい変化を見落とす。
- 小さくすると: 細かい変化も拾うがノイズも増える。
- 目安: **15 px**。
"""
    ),
    "yolo_conf": (
        "YOLO信頼度しきい値 ＝ yolo_conf",
        """
- YOLOv8 の検出信頼度の下限。
- 高くすると: 誤検出減るが見落とし増える。
- 低くすると: 見落とし減るが誤検出増える。
- 目安: **0.5**。
"""
    ),
    "target_short": (
        "共通ダウンサンプル短辺（px）＝ target_short",
        """
- 基準と現在フレームの短辺をこのピクセル数に揃えてから全処理を行う（解像度統一）。
- 大きくすると: 細部まで見えるが重くなり、ノイズも拾いやすい。
- 小さくすると: 軽くなるが細かい変化は消えやすい。
- 目安: **720 前後**。
"""
    ),
    "shift_px_thresh": (
        "ズレ判定しきい値（px）＝ shift_px_thresh",
        """
- カメラ位置のズレ量がこのピクセルを超えると「ズレあり」と判定 → 自動整列を試みる。
- 小さくすると: わずかなズレでも整列（敏感）。
- 大きくすると: 軽微なズレは無視（安定）。
- 目安: **6 px**。
"""
    ),
    "color_threshold": (
        "変化しきい値(%)（色ターゲット）",
        """
- ターゲット色の画素比が基準からどれくらい増減したらアラートを出すか。
- 大きくすると: 鈍感（大きな変化でのみ警告）。
- 小さくすると: 敏感（小さな変化ですぐ警告）。
- 目安: **10〜20%**。
"""
    ),
    "color_k_sigma": (
        "色ゆるさ kσ（色ターゲット）",
        """
- Lab色空間での「基準色の平均±k×標準偏差」を色領域として採用。
- 大きくすると: 色のブレに強いが似た色も拾いやすい。
- 小さくすると: 厳密に色を見られるが少しの変化で見失いやすい。
- 目安: **2.0〜2.5**。
"""
    ),
}